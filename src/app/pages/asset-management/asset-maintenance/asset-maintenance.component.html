<div class="asset-list-wrapper">
  <div class="asset-list-card">
    <div class="asset-list-header">
      <div class="header-title">資產列表</div>
      <div class="header-subtitle">管理所有公司資產</div>
    </div>

    <!-- 搜尋和篩選工具列
    這個多出來的按鈕
    是來自我們剛剛添加的自定義操作選單組件 (app-action-menu) 的一部分。
    當我們將原來的 Material 選單替換為自定義操作選單時，
    這個組件會自動渲染一個帶有「⋯」符號的按鈕，這是操作選單的觸發按鈕。
    在我們的實現中，我們使用了以下方式來顯示選單：
    <button type="button" class="toolbar-btn sort-btn" (click)="sortMenuRef.toggleMenu($event)">
      <span class="icon-updown"></span>排序
    </button>
    <app-action-menu #sortMenuRef ...></app-action-menu>
    -->
    <div class="asset-list-toolbar">
      <div class="search-section">
        <input type="text" class="search-input" placeholder="搜尋資產編號、名稱或保管人…" [(ngModel)]="searchTerm">

        <button type="button" class="toolbar-btn sort-btn" (click)="sortMenuRef.toggleMenu($event)">
          <span class="icon-updown"></span>排序
        </button>
        <app-action-menu #sortMenuRef
          [menuItems]="[
            { icon: 'fas fa-sort-alpha-down', label: '依編號排序', action: 'sort-id' },
            { icon: 'fas fa-font', label: '依名稱排序', action: 'sort-name' },
            { icon: 'fas fa-calendar-alt', label: '依取得日期排序', action: 'sort-date' },
            { icon: 'fas fa-dollar-sign', label: '依價值排序', action: 'sort-value' }
          ]"
          [hideDefaultButton]="true"
          (menuItemClicked)="handleSortAction($event)"
        ></app-action-menu>

        <button type="button" class="toolbar-btn export-btn" (click)="exportData()">
          <span class="icon-download"></span>匯出
        </button>
      </div>

      <div class="filter-section">
        <app-hover-menu
          [buttonText]="'資產分類'"
          [buttonIcon]="'icon-filter'"
          [menuItems]="[
            { icon: 'fas fa-list', label: '顯示全部分類', action: '' },
            { icon: 'fas fa-laptop', label: '電腦設備', action: '電腦設備' },
            { icon: 'fas fa-print', label: '辦公設備', action: '辦公設備' },
            { icon: 'fas fa-chair', label: '辦公家具', action: '辦公家具' },
            { icon: 'fas fa-tv', label: '視聽設備', action: '視聽設備' },
            { icon: 'fas fa-tablet-alt', label: '行動裝置', action: '行動裝置' }
          ]"
          (menuItemClicked)="handleCategoryFilter($event)"
        ></app-hover-menu>

        <app-hover-menu
          [buttonText]="'資產狀態'"
          [buttonIcon]="'icon-filter'"
          [menuItems]="[
            { icon: 'fas fa-list', label: '顯示全部狀態', action: '' },
            { icon: 'fas fa-check-circle', label: '正常使用', action: 'normal' },
            { icon: 'fas fa-tools', label: '維修中', action: 'repair' },
            { icon: 'fas fa-hand-holding', label: '借出', action: 'borrowed' },
            { icon: 'fas fa-trash-alt', label: '報廢', action: 'scrapped' }
          ]"
          (menuItemClicked)="handleStatusFilter($event)"
        ></app-hover-menu>
      </div>
    </div>

    <!-- 批次處理列 -->
    <div class="batch-bar" *ngIf="showBatchBar">
      <span>已選擇 {{selectedAssetsCount}} 個資產</span>

      <button class="batch-btn" (click)="statusMenuRef.toggleMenu($event)">批次更新狀態</button>
      <app-action-menu #statusMenuRef
        [menuItems]="[
          { icon: 'fas fa-check-circle', label: '正常使用', action: 'normal' },
          { icon: 'fas fa-tools', label: '維修中', action: 'repair' },
          { icon: 'fas fa-hand-holding', label: '借出', action: 'borrowed' },
          { icon: 'fas fa-trash-alt', label: '報廢', action: 'scrapped', isDanger: true }
        ]"
        (menuItemClicked)="batchUpdateStatus($event)"
      ></app-action-menu>

      <button class="batch-btn">批次更新位置</button>
      <button class="batch-btn">批次更新保管人</button>
      <button class="batch-btn">批次列印條碼</button>
      <button class="batch-btn">批次匯出資料</button>
      <button class="batch-btn danger" (click)="batchDelete()">批次刪除</button>
      <button class="batch-cancel" (click)="cancelSelection()">取消選取</button>
    </div>

    <!-- 資產表格 -->
    <div class="asset-table-wrap">
      <table class="asset-table">
        <thead>
          <tr>
            <th>
              <mat-checkbox [checked]="allChecked" [indeterminate]="getPageSelectedCount() > 0 && getPageSelectedCount() < paginatedAssets.length" (change)="toggleSelectAll()"></mat-checkbox>
            </th>
            <th (click)="toggleSort('id')" class="sortable-header">
              資產編號
              <i *ngIf="sortField === 'id'" class="fas" [ngClass]="{'fa-sort-up': sortDirection === 'asc', 'fa-sort-down': sortDirection === 'desc'}"></i>
            </th>
            <th (click)="toggleSort('name')" class="sortable-header">
              資產名稱
              <i *ngIf="sortField === 'name'" class="fas" [ngClass]="{'fa-sort-up': sortDirection === 'asc', 'fa-sort-down': sortDirection === 'desc'}"></i>
            </th>
            <th (click)="toggleSort('category')" class="sortable-header">
              分類
              <i *ngIf="sortField === 'category'" class="fas" [ngClass]="{'fa-sort-up': sortDirection === 'asc', 'fa-sort-down': sortDirection === 'desc'}"></i>
            </th>
            <th (click)="toggleSort('location')" class="sortable-header">
              位置
              <i *ngIf="sortField === 'location'" class="fas" [ngClass]="{'fa-sort-up': sortDirection === 'asc', 'fa-sort-down': sortDirection === 'desc'}"></i>
            </th>
            <th (click)="toggleSort('custodian')" class="sortable-header">
              保管人
              <i *ngIf="sortField === 'custodian'" class="fas" [ngClass]="{'fa-sort-up': sortDirection === 'asc', 'fa-sort-down': sortDirection === 'desc'}"></i>
            </th>
            <th (click)="toggleSort('status')" class="sortable-header">
              狀態
              <i *ngIf="sortField === 'status'" class="fas" [ngClass]="{'fa-sort-up': sortDirection === 'asc', 'fa-sort-down': sortDirection === 'desc'}"></i>
            </th>
            <th (click)="toggleSort('acquisitionDate')" class="sortable-header">
              取得日期
              <i *ngIf="sortField === 'acquisitionDate'" class="fas" [ngClass]="{'fa-sort-up': sortDirection === 'asc', 'fa-sort-down': sortDirection === 'desc'}"></i>
            </th>
            <th (click)="toggleSort('modifiedDate')" class="sortable-header">
              修改日期
              <i *ngIf="sortField === 'modifiedDate'" class="fas" [ngClass]="{'fa-sort-up': sortDirection === 'asc', 'fa-sort-down': sortDirection === 'desc'}"></i>
            </th>
            <th (click)="toggleSort('value')" class="sortable-header">
              價值
              <i *ngIf="sortField === 'value'" class="fas" [ngClass]="{'fa-sort-up': sortDirection === 'asc', 'fa-sort-down': sortDirection === 'desc'}"></i>
            </th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let asset of paginatedAssets">
            <td>
              <mat-checkbox [checked]="asset.checked" (change)="toggleAssetSelection(asset)"></mat-checkbox>
            </td>
            <td>{{asset.id}}</td>
            <td>{{asset.name}}</td>
            <td>{{asset.category}}</td>
            <td>{{asset.location}}</td>
            <td>{{asset.custodian}}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(asset.status)">
                {{getStatusName(asset.status)}}
              </span>
            </td>
            <td>{{asset.acquisitionDate}}</td>
            <td>{{asset.modifiedDate}}</td>
            <td>{{asset.value | number}}</td>
            <td>
              <app-action-menu
                [menuItems]="[
                  { icon: 'fas fa-eye', label: '查看詳情', action: 'view' },
                  { icon: 'fas fa-edit', label: '編輯資產', action: 'edit' },
                  { icon: 'fas fa-history', label: '操作歷史', action: 'history' },
                  { icon: 'fas fa-print', label: '列印條碼', action: 'print' },
                  { isSeparator: true },
                  { icon: 'fas fa-trash', label: '刪除資產', action: 'delete', isDanger: true }
                ]"
                (menuItemClicked)="handleAssetAction($event, asset)"
              ></app-action-menu>
            </td>
          </tr>

          <!-- 無資料時顯示 -->
          <tr *ngIf="paginatedAssets.length === 0">
            <td colspan="10" class="no-data-message">
              <div>
                <mat-icon>search_off</mat-icon>
                <p>沒有符合條件的資產</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 分頁器 -->
    <div class="table-pagination">
      <mat-paginator
        [length]="searchAssets().length"
        [pageSize]="itemsPerPage"
        [pageSizeOptions]="[5, 10, 25, 50]"
        [showFirstLastButtons]="true"
        [pageIndex]="currentPage - 1"
        (page)="handlePageEvent($event)"
        aria-label="選擇頁面">
      </mat-paginator>
    </div>
  </div>
</div>
