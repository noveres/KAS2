<div class="asset-list-wrapper">
  <div class="asset-list-card">
    <div class="asset-list-header">
      <div class="header-title">資產列表</div>
      <div class="header-subtitle">管理所有公司資產</div>
    </div>

    <!-- 搜尋和篩選工具列 -->
    <div class="asset-list-toolbar">
      <div class="search-section">
        <input type="text" class="search-input" placeholder="搜尋資產編號、名稱或保管人…" [(ngModel)]="searchTerm">

        <button type="button" class="toolbar-btn sort-btn" [matMenuTriggerFor]="sortMenu">
          <span class="icon-updown"></span>排序
        </button>
        <mat-menu #sortMenu="matMenu">
          <button mat-menu-item>依編號排序</button>
          <button mat-menu-item>依名稱排序</button>
          <button mat-menu-item>依取得日期排序</button>
          <button mat-menu-item>依價值排序</button>
        </mat-menu>

        <button type="button" class="toolbar-btn export-btn" (click)="exportData()">
          <span class="icon-download"></span>匯出
        </button>
      </div>

      <div class="filter-section">
        <mat-select class="toolbar-select" [(ngModel)]="selectedCategory" placeholder="資產分類">
          <mat-option *ngFor="let category of categories" [value]="category.id">{{category.name}}</mat-option>
        </mat-select>

        <mat-select class="toolbar-select" [(ngModel)]="selectedStatus" placeholder="資產狀態">
          <mat-option *ngFor="let status of statuses" [value]="status.id">{{status.name}}</mat-option>
        </mat-select>
      </div>
    </div>

    <!-- 批次處理列 -->
    <div class="batch-bar" *ngIf="showBatchBar">
      <span>已選擇 {{selectedAssetsCount}} 個資產</span>

      <button class="batch-btn" [matMenuTriggerFor]="statusMenu">批次更新狀態</button>
      <mat-menu #statusMenu="matMenu">
        <button mat-menu-item (click)="batchUpdateStatus('normal')">正常使用</button>
        <button mat-menu-item (click)="batchUpdateStatus('repair')">維修中</button>
        <button mat-menu-item (click)="batchUpdateStatus('borrowed')">借出</button>
        <button mat-menu-item (click)="batchUpdateStatus('scrapped')">報廢</button>
      </mat-menu>

      <button class="batch-btn">批次更新位置</button>
      <button class="batch-btn">批次更新保管人</button>
      <button class="batch-btn">批次列印條碼</button>
      <button class="batch-btn">批次匯出資料</button>
      <button class="batch-btn danger" (click)="batchDelete()">批次刪除</button>
      <button class="batch-cancel" (click)="cancelSelection()">取消選取</button>
    </div>

    <!-- 資產表格 -->
    <div class="asset-table-wrap">
      <table class="asset-table">
        <thead>
          <tr>
            <th>
              <mat-checkbox [checked]="allChecked" [indeterminate]="getFilteredSelectedCount() > 0 && getFilteredSelectedCount() < searchAssets().length" (change)="toggleSelectAll()"></mat-checkbox>
            </th>
            <th>資產編號</th>
            <th>資產名稱</th>
            <th>分類</th>
            <th>位置</th>
            <th>保管人</th>
            <th>狀態</th>
            <th>取得日期</th>
            <th>價值</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let asset of paginatedAssets">
            <td>
              <mat-checkbox [checked]="asset.checked" (change)="toggleAssetSelection(asset)"></mat-checkbox>
            </td>
            <td>{{asset.id}}</td>
            <td>{{asset.name}}</td>
            <td>{{asset.category}}</td>
            <td>{{asset.location}}</td>
            <td>{{asset.custodian}}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(asset.status)">
                {{getStatusName(asset.status)}}
              </span>
            </td>
            <td>{{asset.acquisitionDate}}</td>
            <td>{{asset.value | number}}</td>
            <td>
              <app-action-menu
                [menuItems]="[
                  { icon: 'fas fa-eye', label: '查看詳情', action: 'view' },
                  { icon: 'fas fa-edit', label: '編輯資產', action: 'edit' },
                  { icon: 'fas fa-history', label: '操作歷史', action: 'history' },
                  { icon: 'fas fa-print', label: '列印條碼', action: 'print' },
                  { isSeparator: true },
                  { icon: 'fas fa-trash', label: '刪除資產', action: 'delete', isDanger: true }
                ]"
                (menuItemClicked)="handleAssetAction($event, asset)"
              ></app-action-menu>
            </td>
          </tr>

          <!-- 無資料時顯示 -->
          <tr *ngIf="paginatedAssets.length === 0">
            <td colspan="10" class="no-data-message">
              <div>
                <mat-icon>search_off</mat-icon>
                <p>沒有符合條件的資產</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 分頁器 -->
    <div class="table-pagination">
      <button class="page-btn" (click)="previousPage()" [disabled]="currentPage === 1">上一頁</button>
      <span class="page-info">第 {{currentPage}} 頁 / 共 {{Math.ceil(searchAssets().length / itemsPerPage)}} 頁</span>
      <button class="page-btn" (click)="nextPage()" [disabled]="currentPage >= Math.ceil(searchAssets().length / itemsPerPage)">下一頁</button>
    </div>
  </div>
</div>
